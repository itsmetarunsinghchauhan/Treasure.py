<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Treasure Game</title>
  <style>
    /* Simple black theme */
    html,body{height:100%;margin:0;background:#000;color:#fff;font-family:monospace;}
    .wrap{padding:18px;max-width:1000px;margin:0 auto;}
    pre.ascii{white-space:pre; /* preserve all spaces/newlines */ 
             font-family:monospace; font-size:13px; line-height:1;
             color:#fff; margin:0 0 12px 0;}
    #output{white-space:pre-wrap; font-family:monospace; margin:12px 0; color:#ddd;}
    input, button{font-family:monospace; font-size:13px; background:#111; color:#fff; border:1px solid #333; padding:6px;}
    #inputArea{display:none; margin-top:8px;}
    button#start{display:inline-block;margin-top:8px;}
    a.link{color:#7fdfff}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Use <pre> to keep ASCII exactly as typed -->
    <pre class="ascii">
,----,                                                                                      
      ,/   .`|                                                                                 ,--. 
    ,`   .'  :           ,---,               ,-.----.                                        ,--.'| 
  ;    ;     /          '  .' \              \    /  \                   ,--,            ,--,:  : | 
.'___,/    ,'          /  ;    '.            ;   :    \                ,'_ /|         ,`--.'`|  ' : 
|    :     |          :  :       \           |   | .\ :           .--. |  | :         |   :  :  | | 
;    |.';  ;          :  |   /\   \          .   : |: |         ,'_ /| :  . |         :   |   \ | : 
`----'  |  |          |  :  ' ;.   :         |   |  \ :         |  ' | |  . .         |   : '  '; | 
    '   :  ;          |  |  ;/  \   \        |   : |: |         |  | ' |  | |         '   ' ;.    ; 
    |   |  '          '  :  | \  \ ,'        ;   | |  \         :  | | :  ' ;         |   | | \   | 
    '   :  |          |  |  '  '--'          |   | ;\  \        |  ; ' |  | '         '   : |  ; .' 
    ;   |.'           |  :  :                :   ' | \.'        :  | : ;  ; |         |   | '`--'   
    '---'             |  | ,'                :   : :-'          '  :  `--'   \        '   : |       
                      `--''                  |   |.'            :  ,      .-./        ;   |.'       
                                             `---'               `--`----'            '---'       
    Welcome to the Treasure Game
    </pre>

    <!-- Minimal UI -->
    <div id="output"></div>

    <div id="inputArea">
      <input id="userInput" placeholder='Type (e.g., "left")' />
      <button onclick="submitInput()">Enter</button>
    </div>

    <button id="start" onclick="startGame()">Run Game</button>
  </div>

<script>
/* Modified so that when the player finds the chest they can press Enter (empty input)
   or type "open" to open it â€” which will attempt to open the YouTube link.
*/

const output = document.getElementById('output');
const inputArea = document.getElementById('inputArea');
const userInput = document.getElementById('userInput');
const startBtn = document.getElementById('start');

let lives=2, score=0, step=0;
let awaitingOpen = false;           // true when chest found and waiting for Enter/open
const ytLink = 'https://www.youtube.com/watch?v=I2re2B-AkF8';

function printLine(t=''){ output.textContent += t + '\n'; window.scrollTo(0,document.body.scrollHeight); }

function startGame(){
  output.textContent = '';
  startBtn.style.display = 'none';
  inputArea.style.display = 'block';
  userInput.focus();
  lives = 2; score = 0; step = 1; awaitingOpen = false;
  printLine('Welcome to THE LOST TREASURE QUEST');
  printLine('You have 2 lives. Type carefully!');
  printLine('');
  printLine('Do you go "left" (Mangrove Bay) or "right" (Narrow Path)?');
}

function submitInput(){
  // read raw input (may be empty if player pressed Enter)
  const raw = userInput.value;
  const v = raw.trim().toLowerCase();
  userInput.value = '';
  // Allow ENTER (empty string) only when we're awaiting the chest open action
  if(!v && !awaitingOpen) return;
  handleStep(v, raw);
}

function endGame(){
  printLine('');
  printLine('Final Score: ' + score + ' | Lives: ' + lives);
  inputArea.style.display = 'none';
  startBtn.style.display = 'inline-block';
  startBtn.textContent = 'Play Again';
  awaitingOpen = false;
}

function gameOver(msg='Game Over'){
  printLine('');
  printLine(msg);
  endGame();
}

function openTreasureWindow(){
  // Try to open the YouTube link in a new tab/window via user action.
  const win = window.open(ytLink, '_blank');
  if(win){
    printLine('\nThe treasure reveals a secret audio-visual scroll... (YouTube opened in a new tab).');
  } else {
    // Popup blocked â€” provide clickable fallback
    printLine('\nPopup blocked by browser. Click the link below to view the treasure:');
    printLine(ytLink);
    printLine('[Click the link above or copy-paste it into your browser]');
    // Optionally, create a visible anchor for convenience
    const a = document.createElement('a');
    a.href = ytLink;
    a.target = '_blank';
    a.textContent = 'Open Treasure (YouTube)';
    a.className = 'link';
    output.appendChild(a);
    output.appendChild(document.createElement('br'));
    window.scrollTo(0,document.body.scrollHeight);
  }
  awaitingOpen = false;
}

function handleStep(val, rawEntry){
  // if we're awaiting the chest open, accept either "open" or ENTER (empty val)
  if(awaitingOpen){
    if(val === 'open' || rawEntry === '') {
      // open the treasure: increment score, show message and attempt to open YouTube
      score += 5;
      printLine('You put your hand on the chest and lift the lid... ðŸŽº');
      printLine('Inside: A strange melody and a glowing reel. Score: ' + score);
      openTreasureWindow();
      return endGame();
    }
    // allow other commands while awaiting: share or inspect or cancel
    if(val === 'share'){ score += 2; printLine('You shared the treasure. Score: '+score); awaitingOpen = false; return endGame(); }
    if(val === 'inspect'){ printLine('Trap snapped! Chest sealed.'); awaitingOpen = false; return gameOver(); }
    // unrecognized while awaiting: inform user and keep waiting
    printLine('Type "open" or press Enter to open the chest, or "share"/"inspect".');
    return;
  }

  // Normal game flow:
  if(step===1){
    if(val==='left'){ printLine('You slip through Mangrove Bay. Frogs croak...'); }
    else if(val==='right'){ printLine('You meet a pirate! He steals -1 point.'); score--; }
    else return gameOver('Lost in jungle.');
    step=2; printLine(''); printLine('Lagoon ahead. Type "wait" or "swim".'); return;
  }
  if(step===2){
    if(val==='swim'){ if(Math.random()<0.5) return gameOver('A whirlpool got you!'); else { printLine('You swim safely. +1 point.'); score++; } }
    else if(val==='wait'){ printLine('Fisherman ferries you. +1 point.'); score++; }
    else return gameOver('You hesitated and drowned.');
    step=3; printLine(''); printLine('A hut has 3 doors: "red", "blue", "yellow".'); return;
  }
  if(step===3){
    if(val==='red'){ lives--; return gameOver('Serpents attacked! -1 life.'); }
    if(val==='yellow'){ score--; return gameOver('Empty vault. -1 score.'); }
    if(val==='blue'){ step=4; printLine('You find a chest!'); 
        // Now prompt with special instruction: allow Enter or "open" to reveal chest contents
        printLine('Type "open", press Enter, or type "share" or "inspect".');
        awaitingOpen = true;
        userInput.focus();
        return;
    }
    return gameOver('The island rejects you.');
  }
  if(step===4){
    // Won't normally reach here because awaitingOpen handles chest actions
    printLine('You are at the chest. Type "open" to open it.');
    awaitingOpen = true;
    return;
  }
}

// convenience: pressing Enter in the input triggers submitInput()
userInput.addEventListener('keydown', function(e){
  if(e.key === 'Enter'){
    e.preventDefault(); // prevent default form behavior
    submitInput();
  }
});

</script>
</body>
</html>
